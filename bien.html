<script>

/* HEADER / FOOTER */
fetch("components/header.html")
.then(r=>r.text())
.then(d=>document.getElementById("header").innerHTML=d);

fetch("components/footer.html")
.then(r=>r.text())
.then(d=>document.getElementById("footer").innerHTML=d);

/* PARAMS */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

/* SHEET URL (Locations pour test) */
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTBQ5pFGEGAWvo1GNcwrq1CqkiW1yOH_0Ei5Tj3LyNFTBUy1c-VvtcH9GmlzRpY31AsRDjaNnR8F_fE/pub?gid=0&single=true&output=csv";

/* CSV → JSON */
function parseCSV(text){
  const rows = text.split("\n").map(r=>r.trim());
  const headers = rows[0].split(",");

  return rows.slice(1).map(row=>{
    const values = row.split(",");
    let obj = {};
    headers.forEach((header,i)=>{
      obj[header.trim()] = values[i] ? values[i].trim() : "";
    });
    return obj;
  });
}

fetch(sheetURL)
.then(res=>res.text())
.then(csv=>{

  const data = parseCSV(csv);
  const bien = data.find(b => b.id == id);

  if(!bien){
    document.querySelector(".container").innerHTML = "<h2>Bien introuvable</h2>";
    return;
  }

  /* TITRE */
  document.querySelector("h1").innerText = bien.titre;

  /* VILLE */
  document.querySelector(".city").innerHTML = `
    <img src="assets/loca.svg">
    ${bien.ville}
  `;

  /* BADGE */
  const badge = document.querySelector(".badge");
  badge.innerText = bien.disponible === "TRUE" ? "Disponible" : "Vendu / Loué";
  badge.style.background = bien.disponible === "TRUE" ? "#2ecc71" : "#e74c3c";

  /* INFOS */
  document.querySelector(".infos").innerHTML = `
    <div class="info-box"><strong>Surface</strong><br>${bien.surface} m²</div>
    <div class="info-box"><strong>Type</strong><br>${bien.type}</div>
    <div class="info-box"><strong>Loyer</strong><br>${bien.loyer} €</div>
  `;

  /* DESCRIPTION */
  document.querySelector("p").innerHTML = bien.description;

  /* IMAGES */
  const images = bien.images.split("|");
  const mainImg = document.getElementById("mainImg");
  const thumbs = document.querySelector(".thumbs");

  mainImg.src = images[0];

  thumbs.innerHTML = "";
  images.forEach((img,i)=>{
    thumbs.innerHTML += `
      <img src="${img}" onclick="showImage(${i})">
    `;
  });

  window.imageList = images;

});

/* SLIDER MANUEL */
function showImage(i){
  document.getElementById("mainImg").src = window.imageList[i];
}

</script>
